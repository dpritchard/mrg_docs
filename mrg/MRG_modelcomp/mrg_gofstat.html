<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of mrg_gofstat</title>
  <meta name="keywords" content="mrg_gofstat">
  <meta name="description" content="A function to calculate correlation statistics used for comparision of model">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">mrg</a> &gt; <a href="index.html">MRG_modelcomp</a> &gt; mrg_gofstat.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mrg\MRG_modelcomp&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>mrg_gofstat
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>A function to calculate correlation statistics used for comparision of model</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function gofstat = mrg_gofstat(Pred,Obs) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> A function to calculate correlation statistics used for comparision of model
 data to observations or between two different models

 INPUT
   Pred    Data to compare. An m by n matrix with m timesteps and n 
           items or points
   Obs     The reference values. An m by n matrix the same size as Pred.

 OUTPUT
   gofstat A MATLAB structure. See NOTES

 NOTES
   This function returns a number of useful model comparision statitics,
   calculated from pair-wise comparisions the columns in each of the
   matrixes Pred and Obs.  Column 1 in Pred is compared against column 1
   in Obs; Column 2 with column 2; and so-on up to column n.

   The returned structure contains the following information:
       corr : An n-by-4 matrix with
               : The correlation coefficient (R)
               : The lower 95% confidence limit on R
               : The upper 95% confidence limit on R
               : The p-value on R
       Pbar : An n-by-1 vector. The nanmean of Pred
       Obar : An n-by-1 vector. The nanmean of Obs
       bias : An n-by-4 matrix with
               : The nanmean of the pairwise differences
               : The nanmean of the absolute pairwise differences 
               : The standard deviation of pairwise differences
               : The so-called bias-index
       RMS  : An n-by-3 matrix with
               : The root mean square
               : The scatter index (RMS/Obar)
               : The stdev of the differences (same as bias(:,3), above?)
       MEF  : An n-by-1 vector. The modelling efficency
       RI   : An n-by-1 vector. The reliability index

   Note that this uses the nanmean and nanstd functions to calculate the
   mean of the two datasets, which will implicitly ignore missing values.
   Note that this function relies on linear correlations. If your data are
   circular, you might consider a circular correlation coefficient.

 OCTAVE COMPATIBILITY
   Untested.

 REFERENCES
   Stow, C. A., Jolliff, J., McGillicuddy, D. J., Doney, S. C., Allen, J. I., 
       Friedrichs, M. A. M., Rose, K. A., and Wallhead, P.  2009.  Skill 
       assessment for coupled biological/physical models of marine systems.  
       Journal of Marine Systems, 76: 4--15.

 AUTHORS
   Clare Duggan
   Daniel Pritchard

 LICENCE
   Code distributed as part of the MRG toolbox from the Marine Research
   Group at Queens Univeristy Belfast (QUB) School of Planning
   Architecture and Civil Engineering (SPACE). Distributed under a
   creative commons CC BY-SA licence, retaining full copyright of the
   original authors.

   http://creativecommons.org/licenses/by-sa/3.0/
   http://www.qub.ac.uk/space/
   http://www.qub.ac.uk/research-centres/eerc/

 DEVELOPMENT
   v 1.0   2011-10-01
           First version. Clare Duggan
   v 1.1   2012-10-01
           Modified. Clare Duggan
   v 1.2   2013-07-28
           Documentation. Cleanup. Daniel Pritchard
   v 1.3   2013-08-15 DP.
           Fixed error in upper confidence interval.
           More documentation.

% Function Begin!</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function gofstat = mrg_gofstat(Pred,Obs)</a>
0002 <span class="comment">% A function to calculate correlation statistics used for comparision of model</span>
0003 <span class="comment">% data to observations or between two different models</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% INPUT</span>
0006 <span class="comment">%   Pred    Data to compare. An m by n matrix with m timesteps and n</span>
0007 <span class="comment">%           items or points</span>
0008 <span class="comment">%   Obs     The reference values. An m by n matrix the same size as Pred.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% OUTPUT</span>
0011 <span class="comment">%   gofstat A MATLAB structure. See NOTES</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% NOTES</span>
0014 <span class="comment">%   This function returns a number of useful model comparision statitics,</span>
0015 <span class="comment">%   calculated from pair-wise comparisions the columns in each of the</span>
0016 <span class="comment">%   matrixes Pred and Obs.  Column 1 in Pred is compared against column 1</span>
0017 <span class="comment">%   in Obs; Column 2 with column 2; and so-on up to column n.</span>
0018 <span class="comment">%</span>
0019 <span class="comment">%   The returned structure contains the following information:</span>
0020 <span class="comment">%       corr : An n-by-4 matrix with</span>
0021 <span class="comment">%               : The correlation coefficient (R)</span>
0022 <span class="comment">%               : The lower 95% confidence limit on R</span>
0023 <span class="comment">%               : The upper 95% confidence limit on R</span>
0024 <span class="comment">%               : The p-value on R</span>
0025 <span class="comment">%       Pbar : An n-by-1 vector. The nanmean of Pred</span>
0026 <span class="comment">%       Obar : An n-by-1 vector. The nanmean of Obs</span>
0027 <span class="comment">%       bias : An n-by-4 matrix with</span>
0028 <span class="comment">%               : The nanmean of the pairwise differences</span>
0029 <span class="comment">%               : The nanmean of the absolute pairwise differences</span>
0030 <span class="comment">%               : The standard deviation of pairwise differences</span>
0031 <span class="comment">%               : The so-called bias-index</span>
0032 <span class="comment">%       RMS  : An n-by-3 matrix with</span>
0033 <span class="comment">%               : The root mean square</span>
0034 <span class="comment">%               : The scatter index (RMS/Obar)</span>
0035 <span class="comment">%               : The stdev of the differences (same as bias(:,3), above?)</span>
0036 <span class="comment">%       MEF  : An n-by-1 vector. The modelling efficency</span>
0037 <span class="comment">%       RI   : An n-by-1 vector. The reliability index</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%   Note that this uses the nanmean and nanstd functions to calculate the</span>
0040 <span class="comment">%   mean of the two datasets, which will implicitly ignore missing values.</span>
0041 <span class="comment">%   Note that this function relies on linear correlations. If your data are</span>
0042 <span class="comment">%   circular, you might consider a circular correlation coefficient.</span>
0043 <span class="comment">%</span>
0044 <span class="comment">% OCTAVE COMPATIBILITY</span>
0045 <span class="comment">%   Untested.</span>
0046 <span class="comment">%</span>
0047 <span class="comment">% REFERENCES</span>
0048 <span class="comment">%   Stow, C. A., Jolliff, J., McGillicuddy, D. J., Doney, S. C., Allen, J. I.,</span>
0049 <span class="comment">%       Friedrichs, M. A. M., Rose, K. A., and Wallhead, P.  2009.  Skill</span>
0050 <span class="comment">%       assessment for coupled biological/physical models of marine systems.</span>
0051 <span class="comment">%       Journal of Marine Systems, 76: 4--15.</span>
0052 <span class="comment">%</span>
0053 <span class="comment">% AUTHORS</span>
0054 <span class="comment">%   Clare Duggan</span>
0055 <span class="comment">%   Daniel Pritchard</span>
0056 <span class="comment">%</span>
0057 <span class="comment">% LICENCE</span>
0058 <span class="comment">%   Code distributed as part of the MRG toolbox from the Marine Research</span>
0059 <span class="comment">%   Group at Queens Univeristy Belfast (QUB) School of Planning</span>
0060 <span class="comment">%   Architecture and Civil Engineering (SPACE). Distributed under a</span>
0061 <span class="comment">%   creative commons CC BY-SA licence, retaining full copyright of the</span>
0062 <span class="comment">%   original authors.</span>
0063 <span class="comment">%</span>
0064 <span class="comment">%   http://creativecommons.org/licenses/by-sa/3.0/</span>
0065 <span class="comment">%   http://www.qub.ac.uk/space/</span>
0066 <span class="comment">%   http://www.qub.ac.uk/research-centres/eerc/</span>
0067 <span class="comment">%</span>
0068 <span class="comment">% DEVELOPMENT</span>
0069 <span class="comment">%   v 1.0   2011-10-01</span>
0070 <span class="comment">%           First version. Clare Duggan</span>
0071 <span class="comment">%   v 1.1   2012-10-01</span>
0072 <span class="comment">%           Modified. Clare Duggan</span>
0073 <span class="comment">%   v 1.2   2013-07-28</span>
0074 <span class="comment">%           Documentation. Cleanup. Daniel Pritchard</span>
0075 <span class="comment">%   v 1.3   2013-08-15 DP.</span>
0076 <span class="comment">%           Fixed error in upper confidence interval.</span>
0077 <span class="comment">%           More documentation.</span>
0078 <span class="comment">%</span>
0079 <span class="comment">%% Function Begin!</span>
0080 k1 = size(Pred);
0081 k2 = size(Obs);
0082 
0083 <span class="keyword">if</span> k1~=k2
0084     msgbox(<span class="string">'Data sets are not the same size!'</span>);
0085     <span class="keyword">return</span>
0086 <span class="keyword">end</span>
0087 
0088 gofstat = struct();
0089 
0090 <span class="comment">%% Performing Statistical Calculations</span>
0091 <span class="keyword">for</span> n = 1:k1(2);
0092     <span class="comment">% Correlation coefficent with the 95% upper and lower confidence limit</span>
0093     [R,P,RLO,RUP]=corrcoef(Pred(1:<span class="keyword">end</span>,n),Obs(1:<span class="keyword">end</span>,n),<span class="string">'rows'</span>,<span class="string">'pairwise'</span>);
0094     gofstat.corr(n,1) = R(2);
0095     gofstat.corr(n,2) = RLO(2);
0096     gofstat.corr(n,3) = RUP(2);
0097     gofstat.corr(n,4) = P(2);
0098     
0099     <span class="comment">% mean of the different data sets</span>
0100     gofstat.Pbar(n,1) = nanmean(Pred(1:<span class="keyword">end</span>,n));
0101     gofstat.Obar(n,1) = nanmean(Obs(1:<span class="keyword">end</span>,n));
0102     
0103     <span class="comment">% difference of the data sets</span>
0104     delta = Pred(1:<span class="keyword">end</span>,n) - Obs(1:<span class="keyword">end</span>,n);
0105     delta2 = abs(Pred(1:<span class="keyword">end</span>,n) - Obs(1:<span class="keyword">end</span>,n));
0106     <span class="comment">% mean of difference</span>
0107     gofstat.bias(n,1) = nanmean(delta);
0108     <span class="comment">% average absolute error</span>
0109     gofstat.bias(n,2) = nanmean(delta2);
0110     <span class="comment">% standard deviation of difference</span>
0111     gofstat.bias(n,3) = nanstd(delta);
0112     <span class="comment">% bias index of the data set</span>
0113     gofstat.bias(n,4) = gofstat.bias(n,1)/gofstat.Obar(n,1);
0114 
0115     <span class="comment">% RMS</span>
0116     gofstat.RMS(n,1) = sqrt(nanmean(delta.^2));
0117     <span class="comment">% Scatter index</span>
0118     gofstat.RMS(n,2) = gofstat.RMS(n,1)/gofstat.Obar(n,1);
0119     <span class="comment">% Standard deviation of the differences</span>
0120     gofstat.RMS(n,3) = sqrt(nanmean((delta - nanmean(delta)).^2));
0121     
0122     <span class="comment">% MEF - the modeling efficiency</span>
0123     <span class="comment">% observations minus average of observations</span>
0124     difme = (Obs(1:<span class="keyword">end</span>,n) - gofstat.Obar(n,1)).^2;
0125     <span class="comment">% predictions minus average of predictions</span>
0126     difmo = (Pred(1:<span class="keyword">end</span>,n) - Obs(1:<span class="keyword">end</span>,n)).^2;
0127     difme2 = nansum(difme);
0128     difmo2 = nansum(difmo);
0129     <span class="comment">% MEF</span>
0130     gofstat.MEF(n,1) =(difme2-difmo2)/difme2;
0131     
0132     <span class="comment">% RI - Reliability Index</span>
0133     rel = (log(Obs(1:<span class="keyword">end</span>,n)./Pred(1:<span class="keyword">end</span>,n))).^2;
0134     rel2 = nanmean(rel);
0135     rel3 = sqrt(rel2);
0136     gofstat.RI(n,1) = exp(rel3);
0137 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 17-Sep-2013 09:56:39 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>